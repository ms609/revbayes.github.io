#!/usr/bin/rb

# filenames
range_fn = "data/primates.bg.nex"
tree_fn  = "data/primates_tree.nex"
out_fn   = "output/primates_simple"

# read binary (01) presence-absence range data
dat_range_01 = readDiscreteCharacterData(range_fn)

# convert binary ranges into NaturalNumbers
dat_range_n = formatDiscreteCharacterData(dat_range_01, "DEC")


# data dimensions
n_areas  = dat_range_01.nchar()
n_states = floor(2^n_areas)

###############
# Tree models #
###############

# read tree
tree <- readTrees(tree_fn)[1]


#######################
# Biogeography models #
#######################

# the biogeographic event rate multiplier
rate_bg ~ dnLoguniform(1E-4,1E2)
rate_bg.setValue(1E-2)

# the relative dispersal rate
dispersal_rate <- 2.0

# build the relative dispersal rate matrix
for (i in 1:n_areas) {
    for (j in 1:n_areas) {
        dr[i][j] <- dispersal_rate
    }
}

# then the relative extirpation rate (or per-area extinction rates)
extirpation_rate <- 4.0

# build the relative extirpation rate matrix
for (i in 1:n_areas) {
    for (j in 1:n_areas) {
        er[i][j] <- 0.0
    }
    er[i][i] := extirpation_rate
}

# build the DEC rate matrix
Q_DEC := fnDECRateMatrix(dispersalRates=dr,
                         extirpationRates=er)

Q_DEC

Q_DEC.getTransitionProbabilities( 0.1 )
# exit
quit()
